---
title: "Thessis R Code"
author: "Krishna Prasad Deeluntla"
date: "2025-07-31"
output:
  word_document: default
  html_document: default
---


```{r setup, include=FALSE}
# Install required CRAN packages with explicit CRAN mirror
install.packages(
  c("ggplot2", "stringr", "survival", "survminer", "clusterProfiler"),
  repos = "https://cloud.r-project.org"
)

# Install BiocManager from CRAN with explicit mirror if not available
if (!requireNamespace("BiocManager", quietly = TRUE)) {
  install.packages("BiocManager", repos = "https://cloud.r-project.org")
}

# Install required Bioconductor packages
BiocManager::install(c("limma", "DExMA", "org.Hs.eg.db", "Biobase", "sva", "preprocessCore"))

# Load all libraries
library(limma)
library(DExMA)
library(clusterProfiler)
library(org.Hs.eg.db)
library(survival)
library(survminer)
library(ggplot2)
library(stringr)
library(Biobase)
library(sva)
library(preprocessCore)
```

# 3.2 Load Required data file , Data Processing & libraries

```{r}
# --- 1. Clinical Sample Annotation ---
pheno_tcga   <- read.delim("laml_tcga/data_clinical_sample.txt", header=TRUE, stringsAsFactors=FALSE, skip=4)
pheno_ohsu22 <- read.delim("aml_ohsu_2022/data_clinical_sample.txt", header=TRUE, stringsAsFactors=FALSE, skip=4)
pheno_ohsu18 <- read.delim("aml_ohsu_2018/data_clinical_sample.txt", header=TRUE, stringsAsFactors=FALSE, skip=4)

# --- 2. Mutation Data ---
mut_tcga   <- read.delim("laml_tcga/data_mutations.txt", header=TRUE, stringsAsFactors=FALSE, quote = "", comment.char = "")
mut_ohsu22 <- read.delim("aml_ohsu_2022/data_mutations.txt", header=TRUE, stringsAsFactors=FALSE, quote = "", comment.char = "")
mut_ohsu18 <- read.delim("aml_ohsu_2018/data_mutations.txt", header=TRUE, stringsAsFactors=FALSE, quote = "", comment.char = "")

# --- 3. RNA-Seq Gene Expression Data ---
expr_tcga   <- read.delim("laml_tcga/data_mrna_seq_rpkm.txt", check.names=FALSE, header=TRUE)
expr_ohsu22 <- read.delim("aml_ohsu_2022/data_mrna_seq_rpkm.txt", check.names=FALSE, header=TRUE)
expr_ohsu18 <- read.delim("aml_ohsu_2018/data_mrna_seq_rpkm.txt", check.names=FALSE, header=TRUE)

# --- 4. Annotate RUNX1 Mutation Status ---
runx1_tcga   <- unique(mut_tcga$Tumor_Sample_Barcode[mut_tcga$Hugo_Symbol == "RUNX1"])
pheno_tcga$condition   <- ifelse(pheno_tcga$SAMPLE_ID %in% runx1_tcga, "Mutated", "WildType")
runx1_ohsu22 <- unique(mut_ohsu22$Tumor_Sample_Barcode[mut_ohsu22$Hugo_Symbol == "RUNX1"])
pheno_ohsu22$condition <- ifelse(pheno_ohsu22$SAMPLE_ID %in% runx1_ohsu22, "Mutated", "WildType")
runx1_ohsu18 <- unique(mut_ohsu18$Tumor_Sample_Barcode[mut_ohsu18$Hugo_Symbol == "RUNX1"])
pheno_ohsu18$condition <- ifelse(pheno_ohsu18$SAMPLE_ID %in% runx1_ohsu18, "Mutated", "WildType")
# --- PRINT mutation status sample counts for each cohort ---
cat(
  "TCGA - RUNX1 Mutated samples:", sum(pheno_tcga$condition == "Mutated"),
  "| WildType samples:", sum(pheno_tcga$condition == "WildType"), "\n",
  "OHSU22 - RUNX1 Mutated samples:", sum(pheno_ohsu22$condition == "Mutated"),
  "| WildType samples:", sum(pheno_ohsu22$condition == "WildType"), "\n",
  "OHSU18 - RUNX1 Mutated samples:", sum(pheno_ohsu18$condition == "Mutated"),
  "| WildType samples:", sum(pheno_ohsu18$condition == "WildType"), "\n"
)

# Load all libraries
library(limma)
library(DExMA)
library(clusterProfiler)
library(org.Hs.eg.db)
library(survival)
library(survminer)
library(ggplot2)
library(stringr)
library(Biobase)
library(sva)
library(preprocessCore)

```

# 3.3 Annotation of RUNX1 Mutation Status

```{r}
# --- 1. Annotate RUNX1 Mutation Status ---
runx1_tcga   <- unique(mut_tcga$Tumor_Sample_Barcode[mut_tcga$Hugo_Symbol == "RUNX1"])
pheno_tcga$condition   <- ifelse(pheno_tcga$SAMPLE_ID %in% runx1_tcga, "Mutated", "WildType")
runx1_ohsu22 <- unique(mut_ohsu22$Tumor_Sample_Barcode[mut_ohsu22$Hugo_Symbol == "RUNX1"])
pheno_ohsu22$condition <- ifelse(pheno_ohsu22$SAMPLE_ID %in% runx1_ohsu22, "Mutated", "WildType")
runx1_ohsu18 <- unique(mut_ohsu18$Tumor_Sample_Barcode[mut_ohsu18$Hugo_Symbol == "RUNX1"])
pheno_ohsu18$condition <- ifelse(pheno_ohsu18$SAMPLE_ID %in% runx1_ohsu18, "Mutated", "WildType")

```

# 3.4 Sample Filtering

```{r}
# --- 1. Filter Expression and Phenotype to Shared Samples ---
samples_tcga     <- intersect(colnames(expr_tcga)[-(1:2)], pheno_tcga$SAMPLE_ID)
expr_tcga_filt   <- expr_tcga[, c("Hugo_Symbol", "Entrez_Gene_Id", samples_tcga)]
pheno_tcga_filt  <- pheno_tcga[pheno_tcga$SAMPLE_ID %in% samples_tcga, ]
samples_ohsu22   <- intersect(colnames(expr_ohsu22)[-1], pheno_ohsu22$SAMPLE_ID)
expr_ohsu22_filt <- expr_ohsu22[, c("Hugo_Symbol", samples_ohsu22)]
pheno_ohsu22_filt<- pheno_ohsu22[pheno_ohsu22$SAMPLE_ID %in% samples_ohsu22, ]
samples_ohsu18   <- intersect(colnames(expr_ohsu18)[-(1:2)], pheno_ohsu18$SAMPLE_ID)
expr_ohsu18_filt <- expr_ohsu18[, c("Hugo_Symbol", "Entrez_Gene_Id", samples_ohsu18)]
pheno_ohsu18_filt<- pheno_ohsu18[pheno_ohsu18$SAMPLE_ID %in% samples_ohsu18, ]

# --- Summary of Mutated and WildType counts in each data type after filtering ---

# Helper function to count conditions
count_conditions <- function(pheno, samples) {
  filtered <- pheno[pheno$SAMPLE_ID %in% samples, ]
  c(Mutated = sum(filtered$condition == "Mutated"),
    WildType = sum(filtered$condition == "WildType"))
}

cat(
  "===== Sample Counts After Filtering (Expression, Clinical, Mutation) =====\n\n",
  
  "TCGA:\n",
  "  Expression: Mutated =", sum(pheno_tcga_filt$condition == "Mutated"), 
  "| WildType =", sum(pheno_tcga_filt$condition == "WildType"), "\n",
  "  Clinical:   Mutated =", sum(pheno_tcga$condition == "Mutated"), 
  "| WildType =", sum(pheno_tcga$condition == "WildType"), "\n",
  "  Mutation:   Mutated =", length(unique(mut_tcga$Tumor_Sample_Barcode[mut_tcga$Hugo_Symbol == "RUNX1"])),
  "| WildType =", length(setdiff(pheno_tcga$SAMPLE_ID, unique(mut_tcga$Tumor_Sample_Barcode[mut_tcga$Hugo_Symbol == "RUNX1"]))), "\n\n",
  
  "OHSU22:\n",
  "  Expression: Mutated =", sum(pheno_ohsu22_filt$condition == "Mutated"), 
  "| WildType =", sum(pheno_ohsu22_filt$condition == "WildType"), "\n",
  "  Clinical:   Mutated =", sum(pheno_ohsu22$condition == "Mutated"), 
  "| WildType =", sum(pheno_ohsu22$condition == "WildType"), "\n",
  "  Mutation:   Mutated =", length(unique(mut_ohsu22$Tumor_Sample_Barcode[mut_ohsu22$Hugo_Symbol == "RUNX1"])),
  "| WildType =", length(setdiff(pheno_ohsu22$SAMPLE_ID, unique(mut_ohsu22$Tumor_Sample_Barcode[mut_ohsu22$Hugo_Symbol == "RUNX1"]))), "\n\n",
  
  "OHSU18:\n",
  "  Expression: Mutated =", sum(pheno_ohsu18_filt$condition == "Mutated"), 
  "| WildType =", sum(pheno_ohsu18_filt$condition == "WildType"), "\n",
  "  Clinical:   Mutated =", sum(pheno_ohsu18$condition == "Mutated"), 
  "| WildType =", sum(pheno_ohsu18$condition == "WildType"), "\n",
  "  Mutation:   Mutated =", length(unique(mut_ohsu18$Tumor_Sample_Barcode[mut_ohsu18$Hugo_Symbol == "RUNX1"])),
  "| WildType =", length(setdiff(pheno_ohsu18$SAMPLE_ID, unique(mut_ohsu18$Tumor_Sample_Barcode[mut_ohsu18$Hugo_Symbol == "RUNX1"]))), "\n\n"
)
```

# 3.5 Removal of Duplicate Genes and Gene Harmonization

```{r}
# --- 1. Remove Duplicate Gene Symbols ---
expr_tcga_unique   <- expr_tcga_filt[!duplicated(expr_tcga_filt$Hugo_Symbol), ]
rownames(expr_tcga_unique)   <- expr_tcga_unique$Hugo_Symbol
expr_ohsu22_unique <- expr_ohsu22_filt[!duplicated(expr_ohsu22_filt$Hugo_Symbol), ]
rownames(expr_ohsu22_unique) <- expr_ohsu22_unique$Hugo_Symbol
expr_ohsu18_unique <- expr_ohsu18_filt[!duplicated(expr_ohsu18_filt$Hugo_Symbol), ]
rownames(expr_ohsu18_unique) <- expr_ohsu18_unique$Hugo_Symbol

# --- 2. Convert Expression Data to Numeric Matrices for Analysis ---
expr_tcga_mat   <- as.matrix(expr_tcga_unique[, samples_tcga])
expr_ohsu22_mat <- as.matrix(expr_ohsu22_unique[, samples_ohsu22])
expr_ohsu18_mat <- as.matrix(expr_ohsu18_unique[, samples_ohsu18])

# --- 3. Harmonize Genes Across All Cohorts ---
common_genes <- Reduce(intersect, list(
  rownames(expr_tcga_mat),
  rownames(expr_ohsu22_mat),
  rownames(expr_ohsu18_mat)
))
expr_tcga_final   <- expr_tcga_mat[common_genes, ]
expr_ohsu22_final <- expr_ohsu22_mat[common_genes, ]
expr_ohsu18_final <- expr_ohsu18_mat[common_genes, ]

```
# 3.6 Data Transformation and Normalization
# 3.7	Data Quality Assessment

```{r}
# --- PCA Before Log Transformation, Batch Correction, and Normalization ---

# Combine raw (untransformed, unnormalized, uncorrected) expression matrices
expr_tcga_raw   <- expr_tcga_mat[common_genes, ]
expr_ohsu22_raw <- expr_ohsu22_mat[common_genes, ]
expr_ohsu18_raw <- expr_ohsu18_mat[common_genes, ]
expr_all_raw <- cbind(expr_tcga_raw, expr_ohsu22_raw, expr_ohsu18_raw)

# Build annotation vectors
batch_raw <- c(rep("TCGA", ncol(expr_tcga_raw)),
               rep("OHSU22", ncol(expr_ohsu22_raw)),
               rep("OHSU18", ncol(expr_ohsu18_raw)))
condition_raw <- c(
  pheno_tcga$condition[pheno_tcga$SAMPLE_ID %in% colnames(expr_tcga_raw)],
  pheno_ohsu22$condition[pheno_ohsu22$SAMPLE_ID %in% colnames(expr_ohsu22_raw)],
  pheno_ohsu18$condition[pheno_ohsu18$SAMPLE_ID %in% colnames(expr_ohsu18_raw)]
)

# Run PCA
pca_raw <- prcomp(t(expr_all_raw), scale. = TRUE)

# Prepare data frame for ggplot
pca_df_raw <- data.frame(
  PC1 = pca_raw$x[,1],
  PC2 = pca_raw$x[,2],
  Batch = batch_raw,
  Condition = condition_raw
)

# Define manual shape mapping for Batch
batch_shapes <- c("TCGA" = 16, "OHSU22" = 17, "OHSU18" = 15)

# Define manual color mapping for Condition
condition_colors <- c("WildType" = "#00B200", "Mutated" = "#C20000")

ggplot(pca_df_raw, aes(x = PC1, y = PC2, shape = Batch, color = Condition)) +
  geom_point(size = 3) +
  scale_shape_manual(values = batch_shapes) +
  scale_color_manual(values = condition_colors) +
  theme_minimal() +
  labs(
    title = "PCA before log transformation, batch effect correction, and normalization",
    x = "PC1",
    y = "PC2"
  )

#Expression Value Distribution before loge transformation, batch effect and Normalization

hist(as.numeric(expr_tcga_final), breaks=100, main="TCGA Expression Value Distribution", xlab="Value")

hist(as.numeric(expr_ohsu22_final), breaks=100, main="OHSU22 Expression Value Distribution", xlab="Value")

hist(as.numeric(expr_ohsu18_final), breaks=100, main="OHSU18 Expression Value Distribution", xlab="Value")

# --- 10. Log2 Transform TCGA Expression Data ---
expr_tcga_final <- log2(expr_tcga_final + 1)


# Combine matrices
combined_matrix <- cbind(expr_tcga_final, expr_ohsu22_final, expr_ohsu18_final)

# Create batch vector
batch <- c(
  rep("TCGA", ncol(expr_tcga_final)),
  rep("OHSU22", ncol(expr_ohsu22_final)),
  rep("OHSU18", ncol(expr_ohsu18_final))
)

# Run ComBat

combat_matrix <- ComBat(dat = as.matrix(combined_matrix), batch = batch, par.prior = TRUE, prior.plots = FALSE)

# (Optional) Split back into original datasets
n_tcga <- ncol(expr_tcga_final)
n_ohsu22 <- ncol(expr_ohsu22_final)
n_ohsu18 <- ncol(expr_ohsu18_final)

expr_tcga_final_combat <- combat_matrix[, 1:n_tcga]
expr_ohsu22_final_combat <- combat_matrix[, (n_tcga + 1):(n_tcga + n_ohsu22)]
expr_ohsu18_final_combat <- combat_matrix[, (n_tcga + n_ohsu22 + 1):(n_tcga + n_ohsu22 + n_ohsu18)]


expr_tcga_final <- expr_tcga_final_combat
expr_ohsu22_final <- expr_ohsu22_final_combat
expr_ohsu18_final <- expr_ohsu18_final_combat


qn_matrix <- normalize.quantiles(as.matrix(combat_matrix))
colnames(qn_matrix) <- colnames(combat_matrix)
rownames(qn_matrix) <- rownames(combat_matrix)

n_tcga   <- ncol(expr_tcga_final)
n_ohsu22 <- ncol(expr_ohsu22_final)
n_ohsu18 <- ncol(expr_ohsu18_final)

expr_tcga_final   <- qn_matrix[, 1:n_tcga, drop = FALSE]
expr_ohsu22_final <- qn_matrix[, (n_tcga + 1):(n_tcga + n_ohsu22), drop = FALSE]
expr_ohsu18_final <- qn_matrix[, (n_tcga + n_ohsu22 + 1):(n_tcga + n_ohsu22 + n_ohsu18), drop = FALSE]

#Expression Value Distribution before loge transformation, batch effect and Normalization

hist(as.numeric(expr_tcga_final), breaks=100, main="TCGA Expression Distribution", xlab="Expression Value")
hist(as.numeric(expr_ohsu22_final), breaks=100, main="OHSU22 Expression Distribution", xlab="Expression Value")
hist(as.numeric(expr_ohsu18_final), breaks=100, main="OHSU18 Expression Distribution", xlab="Expression Value")


# Combine all samples
expr_all <- cbind(expr_tcga_final, expr_ohsu22_final, expr_ohsu18_final)
pca <- prcomp(t(expr_all), scale. = TRUE)

# Create annotation: batch (TCGA/OHSU22/OHSU18), condition (Mutated/WildType)
batch <- c(rep("TCGA", ncol(expr_tcga_final)),
           rep("OHSU22", ncol(expr_ohsu22_final)),
           rep("OHSU18", ncol(expr_ohsu18_final)))
# Example: combine pheno data for condition
condition <- c(pheno_tcga_filt$condition, pheno_ohsu22_filt$condition, pheno_ohsu18_filt$condition)
pca_df <- data.frame(PC1 = pca$x[,1], PC2 = pca$x[,2], Batch = batch, Condition = condition)


# Define the shapes for Batch
batch_shapes <- c("TCGA" = 16, "OHSU22" = 17, "OHSU18" = 15)

# Define the colors for Condition
condition_colors <- c("WildType" = "#00B200", "Mutated" = "#C20000")

ggplot(pca_df, aes(x = PC1, y = PC2, shape = Batch, color = Condition)) +
  geom_point(size = 3) +
  scale_shape_manual(values = batch_shapes) +
  scale_color_manual(values = condition_colors) +
  theme_minimal() +
  labs(
    title = "PCA after log transformation, batch effect correction, and normalization",
    x = "PC1",
    y = "PC2"
  )

```
# 3.8	Preparation of Data for Meta-Analysis
```{r}
# --- 1. Reorder Columns to Match Phenotype Order ---
expr_tcga_final   <- expr_tcga_final[, pheno_tcga_filt$SAMPLE_ID]
expr_ohsu22_final <- expr_ohsu22_final[, pheno_ohsu22_filt$SAMPLE_ID]
expr_ohsu18_final <- expr_ohsu18_final[, pheno_ohsu18_filt$SAMPLE_ID]


cat(
  "===== Samples USED in META-ANALYSIS =====\n",
  "TCGA:   ", nrow(pheno_tcga_filt), "samples (Mutated =", sum(pheno_tcga_filt$condition == "Mutated"),
  "| WildType =", sum(pheno_tcga_filt$condition == "WildType"), ")\n",
  "OHSU22: ", nrow(pheno_ohsu22_filt), "samples (Mutated =", sum(pheno_ohsu22_filt$condition == "Mutated"),
  "| WildType =", sum(pheno_ohsu22_filt$condition == "WildType"), ")\n",
  "OHSU18: ", nrow(pheno_ohsu18_filt), "samples (Mutated =", sum(pheno_ohsu18_filt$condition == "Mutated"),
  "| WildType =", sum(pheno_ohsu18_filt$condition == "WildType"), ")\n",
  "TOTAL:  ", nrow(pheno_tcga_filt) + nrow(pheno_ohsu22_filt) + nrow(pheno_ohsu18_filt), "samples\n"
)

```

# 3.9	Meta-Analysis Using DExMA


```{r}
# --- 1. DExMA Meta-Analysis & Visualization ---

# 13.1 Ensure sample names match
colnames(expr_tcga_final)   <- pheno_tcga_filt$SAMPLE_ID
rownames(pheno_tcga_filt)   <- pheno_tcga_filt$SAMPLE_ID
colnames(expr_ohsu22_final) <- pheno_ohsu22_filt$SAMPLE_ID
rownames(pheno_ohsu22_filt) <- pheno_ohsu22_filt$SAMPLE_ID
colnames(expr_ohsu18_final) <- pheno_ohsu18_filt$SAMPLE_ID
rownames(pheno_ohsu18_filt) <- pheno_ohsu18_filt$SAMPLE_ID

# 2 Prepare lists for DExMA
expr_list <- list(
  TCGA   = expr_tcga_final,
  OHSU22 = expr_ohsu22_final,
  OHSU18 = expr_ohsu18_final
)
pheno_list <- list(
  TCGA   = pheno_tcga_filt,
  OHSU22 = pheno_ohsu22_filt,
  OHSU18 = pheno_ohsu18_filt
)
namePheno  <- c("condition", "condition", "condition")
expGroups  <- list("Mutated", "Mutated", "Mutated")
refGroups  <- list("WildType", "WildType", "WildType")

# 3 Create DExMA meta-analysis object
objectMA <- createObjectMA(
  listEX     = expr_list,
  listPheno  = pheno_list,
  namePheno  = namePheno,
  expGroups  = expGroups,
  refGroups  = refGroups
)

# 4 Harmonize gene annotation and ensure log2 transformation
objectMA <- allSameID(objectMA, finalID="GeneSymbol", organism="Homo sapiens")
objectMA <- dataLog(objectMA)

# 5 Heterogeneity assessment
heterogeneityTest(objectMA)

# 6 Run meta-analysis (Random Effects Model)
resultsMA <- metaAnalysisDE(
  objectMA,
  typeMethod      = "REM",    # Random Effects Model
  missAllow       = 0.3,
  proportionData  = 0.5
)

# 7 Filter for significant & biologically relevant genes
sig_genes <- resultsMA[resultsMA$FDR < 0.05 & abs(resultsMA$AveFC) > 1, ]


# 8 Save significant genes to CSV
write.csv(sig_genes, file = "DExMA_sig_genes_RUNX1.csv", row.names = TRUE)


```

# 3.11	Visualization of Meta-Analysis ResultS


```{r}
# 1 Visualize: Heatmap of top significant genes

# Custom color palette: green for low, black for mid, red for high
custom_palette <- colorRampPalette(c("green", "black", "red"))(100)

suppressMessages(invisible(capture.output(
  makeHeatmap(
    objectMA,
    resMA         = resultsMA,
    scaling       = "zscor",
    regulation    = "all",
    numSig        = 530,
    fdrSig        = 0.05,
    logFCSig      = 1,
    show_rownames = FALSE,
    col           = custom_palette
  )
)))

# 2 Visualize: Volcano Plot
resultsMA$gene      <- rownames(resultsMA)
resultsMA$negLogFDR <- -log10(resultsMA$FDR)
logfc_cutoff        <- 1
fdr_cutoff          <- 0.05
resultsMA$Status <- "Not Significant"
resultsMA$Status[resultsMA$AveFC > logfc_cutoff & resultsMA$FDR < fdr_cutoff]  <- "Upregulated"
resultsMA$Status[resultsMA$AveFC < -logfc_cutoff & resultsMA$FDR < fdr_cutoff] <- "Downregulated"
resultsMA$Status <- factor(resultsMA$Status, levels = c("Upregulated", "Downregulated", "Not Significant"))

# Replace FDR == 0 with a very small value (e.g., 1e-300) to avoid Inf
resultsMA$FDR_adj <- ifelse(resultsMA$FDR == 0, 1e-300, resultsMA$FDR)

# Calculate -log10(FDR), capping at a maximum for visualization (e.g., 20)
maxY <- 20
resultsMA$negLogFDR <- -log10(resultsMA$FDR_adj)
resultsMA$negLogFDR_capped <- pmin(resultsMA$negLogFDR, maxY)

# Use negLogFDR_capped in your volcano plot
ggplot(resultsMA, aes(x = AveFC, y = negLogFDR_capped, color = Status)) +
  geom_point(alpha=0.8) +
  # ... (rest of your plot code)
  coord_cartesian(ylim = c(0, maxY)) +
  labs(
    title = "Volcano Plot: Meta-Analysis Differential Expression",
    x = "log2 Fold Change",
    y = "-log10(FDR) (capped at 20)"
  )

# 3 Completion Message
cat(sprintf("Meta-analysis complete. %d significant genes saved to DExMA_sig_genes_RUNX1.csv\n", nrow(sig_genes)))

```




# 3.11 Functional Enrichment Analysis

```{r}
# --- 1. Prepare gene list ---
# sig_genes should be your significant gene table. We'll use gene symbols.
sig_genes <- resultsMA[resultsMA$FDR < 0.05 & abs(resultsMA$AveFC) > 1, ]
gene_list <- sig_genes$gene
# --- 2.convert gene symbols to Entrez IDs (required for KEGG) ---
# Convert gene symbols to Entrez IDs
gene_df <- bitr(gene_list, fromType = "SYMBOL",
                toType = "ENTREZID", OrgDb = org.Hs.eg.db)
entrez_genes <- gene_df$ENTREZID

# --- 3. GO Enrichment (Biological Process example) ---
ego <- enrichGO(gene         = gene_list,
                OrgDb        = org.Hs.eg.db,
                keyType      = "SYMBOL",
                ont          = "BP",        # "BP"=Biological Process, "MF"=Molecular Function, "CC"=Cellular Component
                pAdjustMethod = "BH",
                pvalueCutoff  = 0.05,
                qvalueCutoff  = 0.2,
                readable      = TRUE)


# Extract results as a data.frame
ego_df <- as.data.frame(ego)

# Calculate % of input genes in each term
ego_df$Percent <- round(100 * ego_df$Count / sum(ego_df$Count), 2)

# Create a new data frame with your desired columns, sorted by Count
topN <- 15
top_ego <- ego_df[order(-ego_df$Count), ][1:topN, ]

# Build the final table
result_table <- data.frame(
  Category = rep("BP", nrow(top_ego)),  # or ego@ontology if available
  GO_ID = top_ego$ID,
  Term = top_ego$Description,
  Count = top_ego$Count,
  Percent = top_ego$Percent,
  P_value = signif(top_ego$pvalue, 3)
)
print(result_table)
# Order factors by Count for plotting
result_table$Term <- factor(result_table$Term, levels = result_table$Term[order(result_table$Count)])

ggplot(result_table, aes(x = Term, y = Count, fill = -log10(P_value))) +
  geom_bar(stat = "identity") +
  coord_flip() +
  scale_fill_gradient(low = "skyblue", high = "darkblue", name = "-log10(P-value)") +
  labs(
    title = "Top 15 GO BP Terms by Gene Count",
    x = "GO Term",
    y = "Gene Count"
  ) +
  theme_minimal(base_size = 13)


# --- 4. KEGG Pathway Enrichment ---
ekegg <- enrichKEGG(gene         = entrez_genes,
                    organism     = 'hsa',
                    pvalueCutoff = 0.05)


# Split Entrez IDs and map to gene symbols
convert_entrez_to_symbol <- function(entrez_str) {
  entrez_vec <- unlist(strsplit(entrez_str, "/"))
  # Remove any empty entries
  entrez_vec <- entrez_vec[entrez_vec != ""]
  # Map to gene symbol
  gene_symbols <- mapIds(org.Hs.eg.db, entrez_vec, "SYMBOL", "ENTREZID")
  # Collapse back to string
  paste(gene_symbols, collapse = "/")
}

# Replace geneID column with gene symbols
ekegg@result$geneSymbol <- sapply(ekegg@result$geneID, convert_entrez_to_symbol)


# Convert Entrez IDs in geneID to gene symbols
convert_entrez_to_symbol <- function(entrez_str) {
  entrez_vec <- unlist(strsplit(entrez_str, "/"))
  entrez_vec <- entrez_vec[entrez_vec != ""]
  gene_symbols <- mapIds(org.Hs.eg.db, entrez_vec, "SYMBOL", "ENTREZID", multiVals="first")
  paste(gene_symbols, collapse = "/")
}

ekegg_df <- as.data.frame(ekegg)
ekegg_df$Percent <- round(100 * ekegg_df$Count / sum(ekegg_df$Count), 2)
top15 <- ekegg_df[order(-ekegg_df$Count), ][1:15, ]
top15$Genes <- sapply(top15$geneID, convert_entrez_to_symbol)

# Build the result table
result_table <- data.frame(
  Pathway_ID = top15$ID,
  Name = top15$Description,
  Count = top15$Count,
  Percent = top15$Percent,
  P_value = signif(top15$pvalue, 3),
  Genes = top15$Genes
)

# View the table
print(result_table, row.names = FALSE)

write.csv(result_table, "KEGG_top15_table.csv", row.names = FALSE)


# 4. Barplot for top 15 KEGG pathways by gene count
# Order Name factor so bars are sorted by Count
result_table$Name <- factor(result_table$Name, levels = result_table$Name[order(result_table$Count)])

ggplot(result_table, aes(x = Name, y = Count, fill = -log10(P_value))) +
  geom_bar(stat = "identity") +
  coord_flip() +
  scale_fill_gradient(low = "skyblue", high = "darkblue", name = "-log10(P-value)") +
  geom_text(aes(label = paste0(Percent, "%")), hjust = -0.2, size = 3.5) +
  labs(
    title = "Top 15 KEGG Pathways by Gene Count",
    x = "KEGG Pathway",
    y = "Gene Count"
  ) +
  theme_minimal(base_size = 13)



write.table(sig_genes$gene, file = "sig_gene_list.txt", quote = FALSE, row.names = FALSE, col.names = FALSE)



```




# 3.12 Protein-Protein Interaction Network and Hub Gene Analysis

#functional enrichment analysis for top 3 modules

To identify densely connected regions within the protein-protein interaction (PPI) network, module detection was performed using the MCODE (Molecular Complex Detection) plugin in Cytoscape. This approach helps uncover functional subnetworks or clusters that may represent protein complexes or pathway-related gene groups. The PPI network constructed from meta-significant DEGs (confidence score > 0.45) was imported into Cytoscape, and MCODE was used to identify and extract the top three highly interconnected modules. The resulting gene clusters were exported for downstream functional enrichment analysis.

```{r}
# Load the module file
df_module_1 <- read.csv("module1.csv")

# Extract gene names (assuming "shared.name" column holds symbols)
gene_list_module_1 <- unique(df_module_1$shared.name)


# Perform enrichment
module_1_ego <- enrichGO(gene         = gene_list_module_1,
                         OrgDb        = org.Hs.eg.db,
                         keyType      = "SYMBOL",
                         ont          = "BP",        # "BP": Biological Process, "MF": Molecular Function, "CC": Cellular Component
                         pAdjustMethod = "BH",
                         pvalueCutoff  = 0.05,
                         qvalueCutoff  = 0.2)


# Convert enrichGO result to data frame
module_1_ego_df <- as.data.frame(module_1_ego)

# Select and rename columns
final_module_1_go <- module_1_ego_df[, c("ID", "Description", "Count", "pvalue", "geneID")]
colnames(final_module_1_go) <- c("ID", "Term", "Count", "P value", "Genes")


# Get top 10 by Count (descending)
top10 <- final_module_1_go[order(-final_module_1_go$Count), ][1:10, ]



# Select the top 5 by Count
top5 <- top10[order(-top10$Count), ][1:5, ]
print(top5)

# Wrap GO term text to two lines (e.g., 25 characters per line)
top5$Term_wrapped <- str_wrap(top5$Term, width = 25)
top5$Term_wrapped <- factor(top5$Term_wrapped, levels = top5$Term_wrapped[order(top5$Count)])

# Create the bar plot
ggplot(top5, aes(x = Term_wrapped, y = Count, fill = -log10(`P value`))) +
  geom_bar(stat = "identity", width = 0.9) +
  coord_flip() +
  scale_fill_gradient(low = "#a7c7e7", high = "#084594", name = expression(-log[10](P~value))) +
  labs(
    title = "Top 5 GO Biological Process Terms (Module 1)",
    x = "GO Term",
    y = "Gene Count"
  ) +
  geom_text(aes(label = Count), hjust = -0.15, size = 5, fontface = "bold") +
  theme_minimal(base_size = 18) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title.y = element_text(face = "bold", size = 16),
    axis.title.x = element_text(face = "bold", size = 16),
    axis.text.y = element_text(size = 14),
    legend.position = "right"
  ) +
  expand_limits(y = max(top5$Count) + 2)


# Load the module 2 file
df_module_2 <- read.csv("module2.csv")

# Extract gene names (assuming "shared.name" column holds symbols)
gene_list_module_2 <- unique(df_module_2$shared.name)

# Perform enrichment
module_2_ego <- enrichGO(
  gene         = gene_list_module_2,
  OrgDb        = org.Hs.eg.db,
  keyType      = "SYMBOL",
  ont          = "BP",        # "BP": Biological Process, "MF": Molecular Function, "CC": Cellular Component
  pAdjustMethod = "BH",
  pvalueCutoff  = 0.05,
  qvalueCutoff  = 0.2
)

# Convert enrichGO result to data frame
module_2_ego_df <- as.data.frame(module_2_ego)

# Select and rename columns
final_module_2_go <- module_2_ego_df[, c("ID", "Description", "Count", "pvalue", "geneID")]
colnames(final_module_2_go) <- c("ID", "Term", "Count", "P value", "Genes")

# Save to CSV
write.csv(final_module_2_go, "module2_GO_enrichment_selected_columns.csv", row.names = FALSE)

# Get top 10 by Count (descending)
top10_module_2 <- final_module_2_go[order(-final_module_2_go$Count), ][1:10, ]


# Read the CSV for module 2 top 10
#top10_module_2 <- read.csv("module2_GO_enrichment_top10_by_count.csv")

# Select the top 5 by Count
top5_module_2 <- top10_module_2[order(-top10_module_2$Count), ][1:5, ]
print(top5_module_2)

# Wrap GO term text to two lines (e.g., 25 characters per line)
top5_module_2$Term_wrapped <- str_wrap(top5_module_2$Term, width = 25)
top5_module_2$Term_wrapped <- factor(top5_module_2$Term_wrapped, levels = top5_module_2$Term_wrapped[order(top5_module_2$Count)])

# Plot
ggplot(top5_module_2, aes(x = Term_wrapped, y = Count, fill = -log10(`P value`))) +
  geom_bar(stat = "identity", width = 0.9) +
  coord_flip() +
  scale_fill_gradient(low = "#a7c7e7", high = "#084594", name = expression(-log[10](P~value))) +
  labs(
    title = "Top 5 GO Biological Process Terms (Module 2)",
    x = "GO Term",
    y = "Gene Count"
  ) +
  geom_text(aes(label = Count), hjust = -0.15, size = 5, fontface = "bold") +
  theme_minimal(base_size = 18) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title.y = element_text(face = "bold", size = 16),
    axis.title.x = element_text(face = "bold", size = 16),
    axis.text.y = element_text(size = 14),
    legend.position = "right"
  ) +
  expand_limits(y = max(top5_module_2$Count) + 2)

# Load the module 3 file
df_module_3 <- read.csv("module3.csv")

# Extract gene names (assuming "shared.name" column holds symbols)
gene_list_module_3 <- unique(df_module_3$shared.name)


# Perform enrichment
module_3_ego <- enrichGO(
  gene         = gene_list_module_3,
  OrgDb        = org.Hs.eg.db,
  keyType      = "SYMBOL",
  ont          = "BP",        # "BP": Biological Process, "MF": Molecular Function, "CC": Cellular Component
  pAdjustMethod = "BH",
  pvalueCutoff  = 0.05,
  qvalueCutoff  = 0.2
)

# Convert enrichGO result to data frame
module_3_ego_df <- as.data.frame(module_3_ego)

# Select and rename columns
final_module_3_go <- module_3_ego_df[, c("ID", "Description", "Count", "pvalue", "geneID")]
colnames(final_module_3_go) <- c("ID", "Term", "Count", "P value", "Genes")

# Save to CSV
write.csv(final_module_3_go, "module3_GO_enrichment_selected_columns.csv", row.names = FALSE)

# Get top 10 by Count (descending)
top10_module_3 <- final_module_3_go[order(-final_module_3_go$Count), ][1:10, ]


# Read the GO enrichment results for module 3
final_module_3_go <- top10_module_3

# Select the top 5 by Count (descending order)
top5_module_3 <- final_module_3_go[order(-final_module_3_go$Count), ][1:5, ]
print(top5_module_3)

# Wrap GO term text to two lines (e.g., 25 characters per line)
top5_module_3$Term_wrapped <- str_wrap(top5_module_3$Term, width = 25)
top5_module_3$Term_wrapped <- factor(top5_module_3$Term_wrapped, levels = top5_module_3$Term_wrapped[order(top5_module_3$Count)])

# Bar plot
ggplot(top5_module_3, aes(x = Term_wrapped, y = Count, fill = -log10(`P value`))) +
  geom_bar(stat = "identity", width = 0.9) +
  coord_flip() +
  scale_fill_gradient(low = "#a7c7e7", high = "#084594", name = expression(-log[10](P~value))) +
  labs(
    title = "Top 5 GO Biological Process Terms (Module 3)",
    x = "GO Term",
    y = "Gene Count"
  ) +
  geom_text(aes(label = Count), hjust = -0.15, size = 5, fontface = "bold") +
  theme_minimal(base_size = 18) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title.y = element_text(face = "bold", size = 16),
    axis.title.x = element_text(face = "bold", size = 16),
    axis.text.y = element_text(size = 14),
    legend.position = "right"
  ) +
  expand_limits(y = max(top5_module_3$Count) + 2)


```
#functional enrichment analysis for Shortest path Hub genes

To identify the most central and functionally relevant genes within the protein-protein interaction (PPI) network, hub gene analysis was conducted using the CytoHubba plugin in Cytoscape. The Maximal Clique Centrality (MCC) algorithm was employed, which ranks nodes based on their involvement in densely connected subnetworks and the number of shortest paths they participate in. The top 10 hub genes with the highest MCC scores were selected as key regulatory genes. These genes were subsequently used for functional enrichment analysis to explore their associated biological processes and pathways.

```{r}

# Load the hub gene file
df_hub <- read.csv("MCC_top10_with_shortest_paths default node.csv")

# Extract gene names (assuming "shared.name" column holds symbols)
gene_list_hub <- unique(df_hub$shared.name)


# Perform GO enrichment analysis (Biological Process)
hub_ego <- enrichGO(
  gene         = gene_list_hub,
  OrgDb        = org.Hs.eg.db,
  keyType      = "SYMBOL",
  ont          = "BP",        # "BP": Biological Process
  pAdjustMethod = "BH",
  pvalueCutoff  = 0.05,
  qvalueCutoff  = 0.2
)

# View results

# Convert enrichGO result to data frame
hub_ego_df <- as.data.frame(hub_ego)

# Select and rename columns
final_hub_go <- hub_ego_df[, c("ID", "Description", "Count", "pvalue", "geneID")]
colnames(final_hub_go) <- c("ID", "Term", "Count", "P value", "Genes")

# Save to CSV
write.csv(final_hub_go, "hub_GO_enrichment_selected_columns.csv", row.names = FALSE)

# Get top 10 by Count (descending)
top10_hub <- final_hub_go[order(-final_hub_go$Count), ][1:10, ]


# Read the GO enrichment results for hub
final_hub_go <- top10_hub

# Select the top 5 by Count (descending order)
top5_hub <- final_hub_go[order(-final_hub_go$Count), ][1:5, ]
print(top5_hub)

# Wrap GO term text to two lines (e.g., 25 characters per line)
top5_hub$Term_wrapped <- str_wrap(top5_hub$Term, width = 25)
top5_hub$Term_wrapped <- factor(top5_hub$Term_wrapped, levels = top5_hub$Term_wrapped[order(top5_hub$Count)])

# Bar plot
ggplot(top5_hub, aes(x = Term_wrapped, y = Count, fill = -log10(`P value`))) +
  geom_bar(stat = "identity", width = 0.9) +
  coord_flip() +
  scale_fill_gradient(low = "#a7c7e7", high = "#084594", name = expression(-log[10](P~value))) +
  labs(
    title = "Top 5 GO Biological Process Terms (Hub Genes)",
    x = "GO Term",
    y = "Gene Count"
  ) +
  geom_text(aes(label = Count), hjust = -0.15, size = 5, fontface = "bold") +
  theme_minimal(base_size = 18) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title.y = element_text(face = "bold", size = 16),
    axis.title.x = element_text(face = "bold", size = 16),
    axis.text.y = element_text(size = 14),
    legend.position = "right"
  ) +
  expand_limits(y = max(top5_hub$Count) + 2)


```

# 3.13 Survival Analysis

```{r}
#tcga
expr_tcga   <- read.delim("laml_tcga/data_mrna_seq_rpkm.txt", check.names=FALSE, header=TRUE)
mut_tcga   <- read.delim("laml_tcga/data_mutations.txt", header=TRUE, stringsAsFactors=FALSE, quote = "", comment.char = "")
pheno_tcga   <- read.delim("laml_tcga/data_clinical_sample.txt", header=TRUE, stringsAsFactors=FALSE, skip=4)
pheno_tcga_patient   <- read.delim("laml_tcga/data_clinical_patient.txt", header=TRUE, stringsAsFactors=FALSE, skip = 4)


# 1. Identify RUNX1-mutant samples from mut_tcga
runx1_mut_samples <- unique(mut_tcga$Tumor_Sample_Barcode[mut_tcga$Hugo_Symbol == "RUNX1"])

# 2. Get all samples in expr_tcga (expression columns, skipping gene info)
expr_samples <- colnames(expr_tcga)[-(1:2)]

# 3. Label each sample in expr_tcga as RUNX1 mutant or wildtype
runx1_status <- ifelse(expr_samples %in% runx1_mut_samples, "RUNX1_mut", "RUNX1_wildtype")
status_df <- data.frame(SAMPLE_ID = expr_samples, RUNX1_status = runx1_status)


# Merge to add SAMPLE_ID to pheno_ohsu22_patient
pheno_tcga_patient_with_sample <- merge(
  pheno_tcga_patient, 
  pheno_tcga[, c("PATIENT_ID", "SAMPLE_ID")], 
  by = "PATIENT_ID", 
  all.x = TRUE
)

merged_tcga_df <- merge(pheno_tcga_patient_with_sample, status_df, by = "SAMPLE_ID", all = FALSE)

# Subset selected columns into a new dataframe
tcga_survival_df <- merged_tcga_df[, c("SAMPLE_ID", "OS_STATUS", "OS_MONTHS", "RUNX1_status")]


# Replace 'RUNX1_mut' with 'RUNX1_mutation'
tcga_survival_df$RUNX1_status[tcga_survival_df$RUNX1_status == "RUNX1_mut"] <- "RUNX1_mutation"

#ohsu18
expr_ohsu22 <- read.delim("aml_ohsu_2022/data_mrna_seq_rpkm.txt", check.names=FALSE, header=TRUE)
mut_ohsu22 <- read.delim("aml_ohsu_2022/data_mutations.txt", header=TRUE, stringsAsFactors=FALSE, quote = "", comment.char = "")
pheno_ohsu22 <- read.delim("aml_ohsu_2022/data_clinical_sample.txt", header=TRUE, stringsAsFactors=FALSE, skip=4)
pheno_ohsu22_patient <- read.delim("aml_ohsu_2022/data_clinical_patient.txt", header=TRUE, stringsAsFactors=FALSE, skip=4)


# View the first few rows to confirm

# 1. Identify samples with RUNX1 mutation from mut_ohsu22
runx1_mut_samples <- unique(mut_ohsu22$Tumor_Sample_Barcode[mut_ohsu22$Hugo_Symbol == "RUNX1"])

# 2. List all expression sample IDs from expr_ohsu22 (excluding gene column)
expr_samples <- colnames(expr_ohsu22)[-1]

# 3. Assign mutation status to each expression sample
runx1_status <- ifelse(expr_samples %in% runx1_mut_samples, "RUNX1_mutation", "wildtype")

# 4. Create a data frame with sample IDs and status
runx1_status_df <- data.frame(SAMPLE_ID = expr_samples, RUNX1_status = runx1_status)

# 5. Output lists
runx1_mut_list <- runx1_status_df$SAMPLE_ID[runx1_status_df$RUNX1_status == "RUNX1_mutation"]
runx1_wt_list  <- runx1_status_df$SAMPLE_ID[runx1_status_df$RUNX1_status == "wildtype"]


# Merge to add SAMPLE_ID to pheno_ohsu22_patient
pheno_ohsu22_patient_with_sample <- merge(
  pheno_ohsu22_patient, 
  pheno_ohsu22[, c("PATIENT_ID", "SAMPLE_ID")], 
  by = "PATIENT_ID", 
  all.x = TRUE
)

merged_ohsu22_df <- merge(pheno_ohsu22_patient_with_sample, runx1_status_df, by = "SAMPLE_ID", all = FALSE)

# Subset selected columns into a new dataframe
ohsu22_survival_df <- merged_ohsu22_df[, c("SAMPLE_ID", "OS_STATUS", "OS_MONTHS", "RUNX1_status")]

# Replace 'wildtype' with 'RUNX1_wildtype'
ohsu22_survival_df$RUNX1_status[ohsu22_survival_df$RUNX1_status == "wildtype"] <- "RUNX1_wildtype"

#ohsu18
expr_ohsu18 <- read.delim("aml_ohsu_2018/data_mrna_seq_rpkm.txt", check.names=FALSE, header=TRUE)
mut_ohsu18 <- read.delim("aml_ohsu_2018/data_mutations.txt", header=TRUE, stringsAsFactors=FALSE, quote = "", comment.char = "")
pheno_ohsu18 <- read.delim("aml_ohsu_2018/data_clinical_sample.txt", header=TRUE, stringsAsFactors=FALSE, skip=4)
pheno_ohsu18_patient <- read.delim("aml_ohsu_2018/data_clinical_patient.txt", header=TRUE, stringsAsFactors=FALSE, skip=4)
# 1. Identify samples with RUNX1 mutation from mut_ohsu18
runx1_mut_samples_18 <- unique(mut_ohsu18$Tumor_Sample_Barcode[mut_ohsu18$Hugo_Symbol == "RUNX1"])

# 2. List all expression sample IDs from expr_ohsu18 (excluding gene columns)
expr_samples_18 <- colnames(expr_ohsu18)[-c(1,2)]  # Skip Hugo_Symbol and Entrez_Gene_Id

# 3. Assign mutation status to each expression sample
runx1_status_18 <- ifelse(expr_samples_18 %in% runx1_mut_samples_18, "RUNX1_mutation", "wildtype")

# 4. Create a data frame with sample IDs and status
runx1_status_df_18 <- data.frame(SAMPLE_ID = expr_samples_18, RUNX1_status = runx1_status_18)

# 5. Output lists of RUNX1 mutant and wildtype sample IDs
runx1_mut_list_18 <- runx1_status_df_18$SAMPLE_ID[runx1_status_df_18$RUNX1_status == "RUNX1_mutation"]
runx1_wt_list_18  <- runx1_status_df_18$SAMPLE_ID[runx1_status_df_18$RUNX1_status == "wildtype"]


# Merge to add SAMPLE_ID to pheno_ohsu18_patient
pheno_ohsu18_patient_with_sample <- merge(
  pheno_ohsu18_patient, 
  pheno_ohsu18[, c("PATIENT_ID", "SAMPLE_ID")], 
  by = "PATIENT_ID", 
  all.x = TRUE
)

merged_ohsu18_df <- merge(pheno_ohsu18_patient_with_sample, runx1_status_df_18, by = "SAMPLE_ID", all = FALSE)


# Subset selected columns into a new dataframe
ohsu18_survival_df <- merged_ohsu18_df[, c("SAMPLE_ID", "OS_STATUS", "OS_MONTHS", "RUNX1_status")]

# Replace 'wildtype' with 'RUNX1_wildtype' in RUNX1_status column
ohsu18_survival_df$RUNX1_status[ohsu18_survival_df$RUNX1_status == "wildtype"] <- "RUNX1_wildtype"


combined_survival_df1 <- rbind(tcga_survival_df, ohsu22_survival_df, ohsu18_survival_df)


# Extract status (0 or 1) from "0:LIVING" / "1:DECEASED"
combined_survival_df1$OS_event <- ifelse(grepl("DECEASED", combined_survival_df1$OS_STATUS), 1, 0)

# Ensure OS_MONTHS is numeric
combined_survival_df1$OS_MONTHS <- as.numeric(combined_survival_df1$OS_MONTHS)
# Check which rows are problematic
combined_survival_df1[is.na(as.numeric(combined_survival_df1$OS_MONTHS)), "OS_MONTHS"]
sum(!is.na(combined_survival_df1$OS_MONTHS))

surv_data <- combined_survival_df1[!is.na(combined_survival_df1$OS_MONTHS) & !is.na(combined_survival_df1$OS_event), ]


# Create the survival object
surv_obj <- Surv(time = surv_data$OS_MONTHS, event = surv_data$OS_event)

# Fit survival model by RUNX1 mutation status
fit <- survfit(surv_obj ~ RUNX1_status, data = surv_data)

# Plot the Kaplan-Meier curve
ggsurvplot(
  fit,
  data = surv_data,
  pval = TRUE, 
  conf.int = TRUE,
  risk.table = TRUE,
  legend.labs = c("RUNX1_mutation", "RUNX1_wildtype"),
  legend.title = "RUNX1 Status",
  title = "Kaplan-Meier Survival Curve for AML Patients by RUNX1 Mutation",
  xlab = "Overall Survival (Months)",
  ylab = "Survival Probability",
  palette = c("#E64B35", "#4DBBD5")
)


# Create survival object
surv_obj <- Surv(time = surv_data$OS_MONTHS, event = surv_data$OS_event)

# Fit Cox proportional hazards model
cox_model <- coxph(surv_obj ~ RUNX1_status, data = surv_data)

# View model summary
summary(cox_model)
```

